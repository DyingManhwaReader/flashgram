<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashgram</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #141414;
      --surface2: #1c1c1c;
      --border: #242424;
      --accent: #e07a5f;
      --accent-dark: #c96a4f;
      --text: #f0ece4;
      --muted: #6b6b6b;
      --muted-light: #999;
    }

    * { box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
    }

    /* â”€â”€ Navbar â”€â”€ */
    .navbar {
      background: rgba(10,10,10,0.92) !important;
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      height: 60px;
    }
    .navbar-brand {
      font-family: 'DM Serif Display', serif;
      font-style: italic;
      font-size: 1.65rem;
      background: linear-gradient(135deg, #e07a5f, #f2cc8f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }
    .btn-upload-nav {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      border: none;
      color: #fff;
      border-radius: 50px;
      padding: 7px 18px;
      font-size: 0.85rem;
      font-weight: 600;
      transition: opacity .2s, transform .15s;
    }
    .btn-upload-nav:hover { opacity: .88; transform: scale(1.03); color: #fff; }

    /* â”€â”€ Stories Bar â”€â”€ */
    .stories-bar {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding: 16px 0 12px;
      scrollbar-width: none;
    }
    .stories-bar::-webkit-scrollbar { display: none; }
    .story-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .story-ring {
      width: 60px; height: 60px; border-radius: 50%;
      background: linear-gradient(135deg, #e07a5f, #f2cc8f, #81b29a);
      padding: 2.5px;
      display: flex; align-items: center; justify-content: center;
    }
    .story-ring .inner {
      width: 100%; height: 100%; border-radius: 50%;
      border: 2.5px solid var(--bg);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.35rem; font-weight: 700;
      color: #fff;
      font-family: 'DM Serif Display', serif;
    }
    .story-label { font-size: 11px; color: var(--muted-light); max-width: 64px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* â”€â”€ Post Card â”€â”€ */
    .post-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 24px;
      transition: transform .2s, box-shadow .2s;
    }
    .post-card:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,.5); }

    .post-header { padding: 12px 16px; display: flex; align-items: center; gap: 10px; }
    .post-avatar {
      width: 38px; height: 38px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-family: 'DM Serif Display', serif;
      font-size: 1rem; color: #fff; flex-shrink: 0; font-weight: 700;
    }
    .post-username { font-weight: 600; font-size: .9rem; line-height: 1.1; }
    .post-time { font-size: .75rem; color: var(--muted); }

    .post-media { background: #000; width: 100%; display: block; }
    .post-media img, .post-media video {
      width: 100%; max-height: 520px;
      object-fit: cover; display: block;
    }
    .post-media video { object-fit: contain; }

    .post-actions { padding: 12px 16px 0; display: flex; align-items: center; gap: 6px; }
    .action-btn {
      background: none; border: none; color: var(--muted-light);
      padding: 4px 8px 4px 0;
      display: flex; align-items: center; gap: 5px;
      font-size: .85rem; cursor: pointer; transition: color .15s;
    }
    .action-btn:hover { color: var(--text); }
    .action-btn i { font-size: 1.25rem; }
    .action-btn.liked { color: var(--accent); }
    .action-btn.liked i { animation: heartpop .3s ease; }

    @keyframes heartpop {
      0%  { transform: scale(1) }
      40% { transform: scale(1.45) }
      100%{ transform: scale(1) }
    }

    .post-caption { padding: 8px 16px 4px; font-size: .88rem; color: #ccc; line-height: 1.5; }
    .post-caption strong { color: var(--text); margin-right: 5px; }

    .view-comments-btn {
      background: none; border: none; color: var(--muted);
      font-size: .8rem; padding: 0 16px 6px;
      cursor: pointer; display: block;
    }
    .view-comments-btn:hover { color: var(--muted-light); }

    .comments-area { padding: 0 16px 6px; }
    .comment-item { font-size: .82rem; color: #bbb; margin-bottom: 5px; }
    .comment-item strong { color: var(--text); margin-right: 5px; }

    .comment-form {
      border-top: 1px solid var(--border);
      padding: 10px 16px;
      display: flex; gap: 8px; align-items: center;
    }
    .comment-input {
      flex: 1; background: var(--surface2); border: 1px solid var(--border);
      border-radius: 20px; padding: 8px 16px;
      color: var(--text); font-family: 'DM Sans', sans-serif;
      font-size: .82rem; outline: none; transition: border-color .2s;
    }
    .comment-input::placeholder { color: var(--muted); }
    .comment-input:focus { border-color: var(--accent); }
    .btn-comment-post {
      background: var(--accent); border: none; color: #fff;
      border-radius: 20px; padding: 7px 14px;
      font-size: .8rem; font-weight: 600; cursor: pointer;
      transition: background .2s, transform .1s;
    }
    .btn-comment-post:hover { background: var(--accent-dark); transform: scale(1.03); }

    /* â”€â”€ FAB â”€â”€ */
    .fab {
      position: fixed; bottom: 28px; right: 28px;
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      border: none; color: #fff; font-size: 1.5rem;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 8px 24px rgba(224,122,95,.45);
      cursor: pointer; z-index: 999;
      transition: transform .2s, box-shadow .2s;
    }
    .fab:hover { transform: scale(1.1); box-shadow: 0 12px 30px rgba(224,122,95,.6); }

    /* â”€â”€ Modal â”€â”€ */
    .modal-content {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--text);
    }
    .modal-header { border-bottom: 1px solid var(--border); padding: 18px 24px; }
    .modal-title { font-family: 'DM Serif Display', serif; font-size: 1.3rem; }
    .btn-close { filter: invert(1) brightness(.7); }
    .modal-body { padding: 24px; }
    .upload-zone {
      border: 2px dashed var(--border); border-radius: 12px;
      padding: 40px 20px; text-align: center; cursor: pointer;
      transition: border-color .2s, background .2s;
      color: var(--muted);
    }
    .upload-zone:hover { border-color: var(--accent); background: rgba(224,122,95,.05); }
    .upload-zone i { font-size: 2.5rem; display: block; margin-bottom: 10px; color: var(--muted); }
    .form-control-dark {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 10px; color: var(--text);
      font-family: 'DM Sans', sans-serif; padding: 11px 16px;
    }
    .form-control-dark::placeholder { color: var(--muted); }
    .form-control-dark:focus { background: var(--surface2); border-color: var(--accent); color: var(--text); box-shadow: none; outline: none; }
    .btn-share {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      border: none; color: #fff; border-radius: 20px;
      padding: 11px; font-size: .95rem; font-weight: 600;
      width: 100%; cursor: pointer; transition: opacity .2s, transform .1s;
    }
    .btn-share:hover { opacity: .88; transform: scale(1.01); }
    .btn-share:disabled { opacity: .4; cursor: not-allowed; transform: none; }

    .preview-wrap { position: relative; border-radius: 12px; overflow: hidden; background: #000; }
    .preview-wrap img, .preview-wrap video { width: 100%; max-height: 320px; object-fit: cover; display: block; }
    .preview-wrap video { object-fit: contain; }
    .preview-remove {
      position: absolute; top: 10px; right: 10px;
      background: rgba(0,0,0,.65); border: none; color: #fff;
      border-radius: 50%; width: 28px; height: 28px;
      font-size: 1.1rem; display: flex; align-items: center; justify-content: center;
      cursor: pointer; line-height: 1;
    }

    /* â”€â”€ Empty / Loading â”€â”€ */
    .empty-feed { text-align: center; padding: 80px 20px; color: var(--muted); }
    .empty-feed i { font-size: 3rem; display: block; margin-bottom: 12px; }

    /* â”€â”€ Scrollbar â”€â”€ */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 4px; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• NAVBAR â•â•â•â•â•â•â•â•â•â• -->
<nav class="navbar sticky-top navbar-dark">
  <div class="container" style="max-width:680px;">
    <a class="navbar-brand mb-0 h1" href="#">flashgram</a>
    <button class="btn-upload-nav d-none d-sm-flex align-items-center gap-2" onclick="openModal()">
      <i class="bi bi-plus-lg"></i> New Post
    </button>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â• -->
<main class="container py-3" style="max-width:680px;">

  <!-- Stories Bar -->
  <div class="stories-bar mb-2" id="storiesBar"></div>
  <hr style="border-color:var(--border); margin: 0 0 20px;" />

  <!-- Feed -->
  <div id="feed"></div>
</main>

<!-- â•â•â•â•â•â•â•â•â•â• FAB â•â•â•â•â•â•â•â•â•â• -->
<button class="fab d-sm-none" onclick="openModal()" title="New Post">
  <i class="bi bi-plus-lg"></i>
</button>

<!-- â•â•â•â•â•â•â•â•â•â• UPLOAD MODAL â•â•â•â•â•â•â•â•â•â• -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width:520px;">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">New Post</span>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex flex-column gap-3">

        <!-- Upload Zone -->
        <div id="uploadZone" class="upload-zone" onclick="document.getElementById('fileInput').click()">
          <i class="bi bi-image"></i>
          <div style="font-size:.9rem;">Click to upload a photo or video</div>
          <div style="font-size:.78rem;margin-top:4px;color:var(--muted)">JPG Â· PNG Â· GIF Â· MP4 Â· MOV</div>
        </div>
        <div id="previewWrap" class="preview-wrap d-none">
          <img id="previewImg" src="" alt="" class="d-none" />
          <video id="previewVid" src="" controls playsinline class="d-none"></video>
          <button class="preview-remove" onclick="clearMedia()"><i class="bi bi-x"></i></button>
        </div>
        <input type="file" id="fileInput" accept="image/*,video/*" class="d-none" onchange="handleFile(event)" />

        <input type="text" id="inputUsername" class="form-control form-control-dark" placeholder="Your name (optional)" />
        <textarea id="inputCaption" class="form-control form-control-dark" rows="3" placeholder="Write a captionâ€¦" style="resize:none;"></textarea>

        <button class="btn-share" id="btnShare" disabled onclick="submitPost()">
          <i class="bi bi-send me-2"></i>Share Post
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AVATAR_COLORS = ["#e07a5f","#81b29a","#f2cc8f","#9b8ea8","#6b8cce","#e29578","#52796f","#d4a5a5"];

const SAMPLE_POSTS = [
  {
    id:"s1", username:"wanderlust_kai", avatar:"K", color:"#e07a5f",
    caption:"Golden hour never disappoints ðŸŒ…",
    mediaUrl:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=720&q=80",
    mediaType:"image", likes:284, liked:false,
    comments:[{user:"sol_beats",text:"Absolutely stunning! ðŸ˜"},{user:"nova.pics",text:"Where is this?? ðŸ”ï¸"}],
    time:"2h ago"
  },
  {
    id:"s2", username:"urban.frames", avatar:"U", color:"#6b8cce",
    caption:"City lights and endless nights ðŸŒƒ",
    mediaUrl:"https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=720&q=80",
    mediaType:"image", likes:512, liked:false,
    comments:[{user:"pixl_dreams",text:"This is pure art."}],
    time:"5h ago"
  },
  {
    id:"s3", username:"forest.dweller", avatar:"F", color:"#81b29a",
    caption:"Into the wild ðŸŒ¿ Breathing feels different here",
    mediaUrl:"https://images.unsplash.com/photo-1448375240586-882707db888b?w=720&q=80",
    mediaType:"image", likes:139, liked:false,
    comments:[],
    time:"1d ago"
  },
  {
    id:"s4", username:"oceanside_lux", avatar:"O", color:"#f2cc8f",
    caption:"Salt in the air, peace in my heart ðŸŒŠ",
    mediaUrl:"https://images.unsplash.com/photo-1505118380757-91f5f5632de0?w=720&q=80",
    mediaType:"image", likes:391, liked:false,
    comments:[{user:"wanderlust_kai",text:"Need to be here right now ðŸŒŠ"},{user:"zen.click",text:"So calming!"}],
    time:"3d ago"
  }
];

let posts = [];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STORAGE  (localStorage fallback)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY = "flashgram_posts_v2";

function loadFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch { return []; }
}

function saveToStorage() {
  const userPosts = posts.filter(p => !p.id.startsWith("s"));
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(userPosts)); } catch {}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  const stored = loadFromStorage();
  posts = [...stored, ...SAMPLE_POSTS];
  renderStories();
  renderFeed();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STORIES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStories() {
  const bar = document.getElementById("storiesBar");
  bar.innerHTML = "";
  const unique = [];
  const seen = new Set();
  for (const p of posts) {
    if (!seen.has(p.username)) { seen.add(p.username); unique.push(p); }
  }
  unique.slice(0, 12).forEach(p => {
    bar.innerHTML += `
      <div class="story-item">
        <div class="story-ring">
          <div class="inner" style="background:${p.color}">${p.avatar}</div>
        </div>
        <span class="story-label">${p.username}</span>
      </div>`;
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  FEED RENDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFeed() {
  const feed = document.getElementById("feed");
  if (posts.length === 0) {
    feed.innerHTML = `
      <div class="empty-feed">
        <i class="bi bi-camera"></i>
        <p>No posts yet. Be the first to share something!</p>
      </div>`;
    return;
  }
  feed.innerHTML = posts.map(p => buildPostHTML(p)).join("");
}

function buildPostHTML(p) {
  const commentsHTML = p.comments.map((c,i) => `
    <div class="comment-item"><strong>${esc(c.user)}</strong>${esc(c.text)}</div>`).join("");

  const mediaHTML = p.mediaType === "video"
    ? `<video src="${p.mediaUrl}" controls playsinline style="width:100%;max-height:520px;object-fit:contain;display:block;background:#000;"></video>`
    : `<img src="${p.mediaUrl}" alt="" style="width:100%;max-height:520px;object-fit:cover;display:block;" loading="lazy" />`;

  return `
  <div class="post-card" id="post-${p.id}">
    <div class="post-header">
      <div class="post-avatar" style="background:${p.color}">${p.avatar}</div>
      <div class="flex-grow-1">
        <div class="post-username">${esc(p.username)}</div>
        <div class="post-time">${p.time}</div>
      </div>
      <button class="action-btn" style="padding:0;color:var(--muted-light)"><i class="bi bi-three-dots"></i></button>
    </div>

    <div class="post-media">${mediaHTML}</div>

    <div class="post-actions">
      <button class="action-btn ${p.liked ? 'liked' : ''}" onclick="toggleLike('${p.id}')">
        <i class="bi ${p.liked ? 'bi-heart-fill' : 'bi-heart'}"></i>
        <span id="likes-${p.id}">${p.likes}</span>
      </button>
      <button class="action-btn" onclick="focusComment('${p.id}')">
        <i class="bi bi-chat"></i>
        <span>${p.comments.length}</span>
      </button>
      <button class="action-btn ms-auto"><i class="bi bi-bookmark"></i></button>
    </div>

    ${p.caption ? `<div class="post-caption"><strong>${esc(p.username)}</strong>${esc(p.caption)}</div>` : ""}

    ${p.comments.length > 0 ? `
      <button class="view-comments-btn" id="vcbtn-${p.id}" onclick="toggleComments('${p.id}')">
        View ${p.comments.length} comment${p.comments.length !== 1 ? "s" : ""}
      </button>
      <div class="comments-area d-none" id="comments-${p.id}">${commentsHTML}</div>
    ` : `<div class="comments-area d-none" id="comments-${p.id}"></div>`}

    <div class="comment-form">
      <i class="bi bi-emoji-smile" style="color:var(--muted);font-size:1.1rem;"></i>
      <input class="comment-input" id="cinput-${p.id}" placeholder="Add a commentâ€¦"
             onkeydown="if(event.key==='Enter')addComment('${p.id}')"
             oninput="toggleCommentBtn('${p.id}')" />
      <button class="btn-comment-post d-none" id="cbtn-${p.id}" onclick="addComment('${p.id}')">Post</button>
    </div>
  </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INTERACTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleLike(id) {
  const p = posts.find(x => x.id === id);
  if (!p) return;
  p.liked = !p.liked;
  p.likes += p.liked ? 1 : -1;
  saveToStorage();

  const card = document.getElementById(`post-${id}`);
  const btn = card.querySelector(".action-btn");
  const icon = btn.querySelector("i");
  const countEl = document.getElementById(`likes-${id}`);

  btn.classList.toggle("liked", p.liked);
  icon.className = p.liked ? "bi bi-heart-fill" : "bi bi-heart";
  countEl.textContent = p.likes;
  if (p.liked) { icon.style.animation = "none"; icon.offsetHeight; icon.style.animation = ""; }
}

function toggleComments(id) {
  const area = document.getElementById(`comments-${id}`);
  const btn  = document.getElementById(`vcbtn-${id}`);
  const p    = posts.find(x => x.id === id);
  const open = area.classList.toggle("d-none");
  if (btn) btn.textContent = open
    ? `View ${p.comments.length} comment${p.comments.length !== 1 ? "s" : ""}`
    : "Hide comments";
}

function focusComment(id) {
  const inp = document.getElementById(`cinput-${id}`);
  if (inp) { inp.focus(); }
}

function toggleCommentBtn(id) {
  const inp = document.getElementById(`cinput-${id}`);
  const btn = document.getElementById(`cbtn-${id}`);
  btn.classList.toggle("d-none", !inp.value.trim());
}

function addComment(id) {
  const inp = document.getElementById(`cinput-${id}`);
  const text = (inp.value || "").trim();
  if (!text) return;

  const p = posts.find(x => x.id === id);
  p.comments.push({ user: "you", text });
  saveToStorage();

  const area = document.getElementById(`comments-${id}`);
  area.classList.remove("d-none");
  area.innerHTML += `<div class="comment-item"><strong>you</strong>${esc(text)}</div>`;

  const btn = document.getElementById(`vcbtn-${id}`);
  if (btn) btn.textContent = `Hide comments`;

  inp.value = "";
  document.getElementById(`cbtn-${id}`).classList.add("d-none");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  UPLOAD MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let uploadModal;
let pendingMedia = null;

window.addEventListener("DOMContentLoaded", () => {
  uploadModal = new bootstrap.Modal(document.getElementById("uploadModal"));
  init();
});

function openModal() { uploadModal.show(); }

function handleFile(e) {
  const file = e.target.files[0];
  if (!file) return;
  const isVideo = file.type.startsWith("video/");
  const reader = new FileReader();
  reader.onload = ev => {
    pendingMedia = { url: ev.target.result, type: isVideo ? "video" : "image" };
    document.getElementById("uploadZone").classList.add("d-none");
    const wrap = document.getElementById("previewWrap");
    wrap.classList.remove("d-none");
    if (isVideo) {
      document.getElementById("previewImg").classList.add("d-none");
      const vid = document.getElementById("previewVid");
      vid.src = ev.target.result;
      vid.classList.remove("d-none");
    } else {
      document.getElementById("previewVid").classList.add("d-none");
      const img = document.getElementById("previewImg");
      img.src = ev.target.result;
      img.classList.remove("d-none");
    }
    document.getElementById("btnShare").disabled = false;
  };
  reader.readAsDataURL(file);
}

function clearMedia() {
  pendingMedia = null;
  document.getElementById("fileInput").value = "";
  document.getElementById("previewWrap").classList.add("d-none");
  document.getElementById("previewImg").classList.add("d-none");
  document.getElementById("previewVid").classList.add("d-none");
  document.getElementById("uploadZone").classList.remove("d-none");
  document.getElementById("btnShare").disabled = true;
}

function submitPost() {
  if (!pendingMedia) return;
  const username = document.getElementById("inputUsername").value.trim() || "anonymous";
  const caption  = document.getElementById("inputCaption").value.trim();
  const colorIdx = Math.floor(Math.random() * AVATAR_COLORS.length);

  const newPost = {
    id: "u" + Date.now(),
    username, avatar: username[0].toUpperCase(),
    color: AVATAR_COLORS[colorIdx],
    caption, mediaUrl: pendingMedia.url,
    mediaType: pendingMedia.type,
    likes: 0, liked: false, comments: [], time: "just now"
  };

  posts.unshift(newPost);
  saveToStorage();
  renderStories();
  renderFeed();
  uploadModal.hide();

  // Reset
  clearMedia();
  document.getElementById("inputUsername").value = "";
  document.getElementById("inputCaption").value = "";
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  UTILITIES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(str) {
  if (!str) return "";
  return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}
</script>
</body>
</html>